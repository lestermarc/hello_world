--------------------------------------------------------
--  DDL for Procedure C9_SQM_GET_RESULTS_DETAIL
--------------------------------------------------------
set define off;

  CREATE OR REPLACE PROCEDURE "C9_SQM_GET_RESULTS_DETAIL" (

aRefCursor in out CRYSTAL_CURSOR_TYPES.DualCursorTyp,
EvaluationId in varchar2,
ResultId in varchar2,
ThirdId in varchar2)

IS

BEGIN

OPEN AREFCURSOR FOR

SELECT PEN.*,
AXE.SAX_NAME,
AXE.C_AXIS_TYPE,
AXE.SAX_DESCRIPTION,
AXE.SAX_COMMENT,
DET.PDE_BASIS_DELAY,
DET.PDE_INTERMEDIATE_DELAY,
DET.PDE_FINAL_DELAY,
DET.PDE_BASIS_QUANTITY,
DET.PDE_INTERMEDIATE_QUANTITY,
DET.PDE_FINAL_QUANTITY,
DOC.DMT_NUMBER,
DOC.DMT_DATE_DOCUMENT,
DOC.DMT_DATE_VALUE,
DOC.DMT_PARTNER_NUMBER,
DOC.DMT_DATE_PARTNER_DOCUMENT,
DOC.DMT_PARTNER_REFERENCE,
GOO.GOO_MAJOR_REFERENCE,
GOO.GOO_SECONDARY_REFERENCE,
PAC.REP_DESCR,
REC.RCO_NUMBER
from SQM_PENALTY PEN,
	 SQM_EVAL_S_PENALTY SPEN,
	 SQM_AXIS AXE,
	 DOC_POSITION_DETAIL DET,
	 DOC_POSITION POS,
	 DOC_DOCUMENT DOC,
	 GCO_GOOD GOO,
	 PAC_REPRESENTATIVE PAC,
	 DOC_RECORD REC
WHERE SQM_FUNCTIONS.IsPenaltyUsed(PEN.SQM_PENALTY_ID, To_Number(ResultId))<>0
AND SPEN.SQM_EVALUATION_ID = To_Number(EvaluationId)
AND SPEN.SQM_PENALTY_ID = PEN.SQM_PENALTY_ID
AND PEN.SQM_AXIS_ID = AXE.SQM_AXIS_ID
AND PEN.PAC_THIRD_ID = To_Number(ThirdId)
AND PEN.DOC_POSITION_DETAIL_ID = DET.DOC_POSITION_DETAIL_ID
AND PEN.DOC_POSITION_ID = POS.DOC_POSITION_ID
AND DET.DOC_DOCUMENT_ID = DOC.DOC_DOCUMENT_ID
AND PEN.GCO_GOOD_ID = GOO.GCO_GOOD_ID (+)
AND POS.PAC_REPRESENTATIVE_ID = PAC.PAC_REPRESENTATIVE_ID (+)
AND POS.DOC_RECORD_ID = REC.DOC_RECORD_ID (+);

END;
